import{computed as f,defineComponent as h,h as F,onMounted as H,ref as v,watch as p,Fragment as y}from"vue";import{render as k}from"../../utils/render.js";import{Hidden as R,Features as M}from"../../internal/hidden.js";import{dom as L}from"../../utils/dom.js";import{focusIn as d,Focus as E,focusElement as m,FocusResult as P}from"../../utils/focus-management.js";import{match as B}from"../../utils/match.js";import{useTabDirection as S,Direction as b}from"../../hooks/use-tab-direction.js";import{getOwnerDocument as g}from"../../utils/owner.js";import{useEventListener as I}from"../../hooks/use-event-listener.js";import"../../utils/micro-task.js";var D=(e=>(e[e.None=1]="None",e[e.InitialFocus=2]="InitialFocus",e[e.TabLock=4]="TabLock",e[e.FocusLock=8]="FocusLock",e[e.RestoreFocus=16]="RestoreFocus",e[e.All=30]="All",e))(D||{});let V=Object.assign(h({name:"FocusTrap",props:{as:{type:[Object,String],default:"div"},initialFocus:{type:Object,default:null},features:{type:Number,default:30},containers:{type:Object,default:v(new Set)}},inheritAttrs:!1,setup(o,{attrs:u,slots:l,expose:r}){let t=v(null);r({el:t,$el:t});let a=f(()=>g(t));O({ownerDocument:a},f(()=>Boolean(o.features&16)));let e=A({ownerDocument:a,container:t,initialFocus:f(()=>o.initialFocus)},f(()=>Boolean(o.features&2)));N({ownerDocument:a,container:t,containers:o.containers,previousActiveElement:e},f(()=>Boolean(o.features&8)));let s=S();function i(){let n=L(t);!n||B(s.value,{[b.Forwards]:()=>d(n,E.First),[b.Backwards]:()=>d(n,E.Last)})}return()=>{let n={},T={ref:t},{features:c,initialFocus:C,containers:_,...w}=o;return F(y,[Boolean(c&4)&&F(R,{as:"button",type:"button",onFocus:i,features:M.Focusable}),k({ourProps:T,theirProps:{...u,...w},slot:n,attrs:u,slots:l,name:"FocusTrap"}),Boolean(c&4)&&F(R,{as:"button",type:"button",onFocus:i,features:M.Focusable})])}}}),{features:D});function O({ownerDocument:o},u){let l=v(null),r={value:!1};H(()=>{p(u,(t,a)=>{var e;t!==a&&(!u.value||(r.value=!0,l.value||(l.value=(e=o.value)==null?void 0:e.activeElement)))},{immediate:!0}),p(u,(t,a,e)=>{t!==a&&(!u.value||e(()=>{r.value!==!1&&(r.value=!1,m(l.value),l.value=null)}))},{immediate:!0})})}function A({ownerDocument:o,container:u,initialFocus:l},r){let t=v(null);return H(()=>{p([u,l,r],(a,e)=>{if(a.every((i,n)=>(e==null?void 0:e[n])===i)||!r.value)return;let s=L(u);!s||requestAnimationFrame(()=>{var T,c;let i=L(l),n=(T=o.value)==null?void 0:T.activeElement;if(i){if(i===n){t.value=n;return}}else if(s.contains(n)){t.value=n;return}i?m(i):d(s,E.First|E.NoScroll)===P.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),t.value=(c=o.value)==null?void 0:c.activeElement})},{immediate:!0,flush:"post"})}),t}function N({ownerDocument:o,container:u,containers:l,previousActiveElement:r},t){var a;I((a=o.value)==null?void 0:a.defaultView,"focus",e=>{if(!t.value)return;let s=new Set(l==null?void 0:l.value);s.add(u);let i=r.value;if(!i)return;let n=e.target;n&&n instanceof HTMLElement?j(s,n)?(r.value=n,m(n)):(e.preventDefault(),e.stopPropagation(),m(i)):m(r.value)},!0)}function j(o,u){var l;for(let r of o)if((l=r.value)!=null&&l.contains(u))return!0;return!1}export{V as FocusTrap};
